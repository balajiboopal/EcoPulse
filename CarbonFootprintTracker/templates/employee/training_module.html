{% extends 'base.html' %}

{% block title %}{{ module.module_name }} - Training{% endblock %}

{% block content %}
<div class="container training-module">
    <div class="module-header">
        <h1 class="page-title">{{ content.title }}</h1>
        <div class="module-progress">
            <div class="progress-bar" style="width: {{ module.completion_percentage }}%;">
                <span class="progress-text">{{ module.completion_percentage|int }}%</span>
            </div>
        </div>
        <p class="progress-detail">Section {{ content.current_section }} of {{ content.sections }}</p>
    </div>
    
    <div class="module-navigation">
        <a href="{{ url_for('employee.training') }}" class="btn btn-outline">
            <i class="fa fa-arrow-left"></i> Back to Training
        </a>
        
        <div class="section-navigation">
            <button id="prevSection" class="btn btn-outline" {% if content.current_section == 1 %}disabled{% endif %}>
                <i class="fa fa-chevron-left"></i> Previous
            </button>
            <button id="nextSection" class="btn btn-primary" {% if content.current_section == content.sections %}disabled{% endif %}>
                Next <i class="fa fa-chevron-right"></i>
            </button>
        </div>
    </div>
    
    <div class="module-content">
        <!-- Section 1: Introduction -->
        <div class="module-section" id="section1" {% if content.current_section != 1 %}style="display: none;"{% endif %}>
            <h2>Introduction</h2>
            <p>Welcome to the {{ content.title }} training module. This module will help you understand key concepts related to carbon management and sustainability.</p>
            
            <div class="content-block">
                <h3>Learning Objectives</h3>
                <ul>
                    <li>Understand the fundamental principles of carbon footprints</li>
                    <li>Learn how to measure and track your environmental impact</li>
                    <li>Discover practical strategies to reduce your carbon emissions</li>
                    <li>Implement sustainable practices in your daily work routine</li>
                </ul>
            </div>
            
            <div class="content-block">
                <h3>Module Structure</h3>
                <p>This module consists of {{ content.sections }} sections:</p>
                <ol>
                    <li>Introduction</li>
                    <li>Key Concepts</li>
                    <li>Practical Applications</li>
                    {% if content.sections > 3 %}
                    <li>Case Studies</li>
                    {% endif %}
                    {% if content.sections > 4 %}
                    <li>Assessment</li>
                    {% endif %}
                    <li>Conclusion and Resources</li>
                </ol>
            </div>
        </div>
        
        <!-- Section 2: Key Concepts -->
        <div class="module-section" id="section2" {% if content.current_section != 2 %}style="display: none;"{% endif %}>
            <h2>Key Concepts</h2>
            
            <div class="content-block">
                <h3>What is a Carbon Footprint?</h3>
                <p>A carbon footprint is the total amount of greenhouse gases (including carbon dioxide and methane) that are generated by our actions. The average carbon footprint for a person in the United States is 16 tons, one of the highest rates in the world.</p>
                
                <div class="info-box">
                    <h4>Did You Know?</h4>
                    <p>The global average carbon footprint is closer to 4 tons. To have the best chance of avoiding a 2â„ƒ rise in global temperatures, the average global carbon footprint per person needs to drop to under 2 tons by 2050.</p>
                </div>
            </div>
            
            <div class="content-block">
                <h3>Sources of Carbon Emissions in the Workplace</h3>
                <ul>
                    <li><strong>Commuting:</strong> Transportation to and from work</li>
                    <li><strong>Energy Usage:</strong> Electricity for lighting, computers, and HVAC systems</li>
                    <li><strong>Business Travel:</strong> Air travel, hotel stays, and rental cars</li>
                    <li><strong>Office Supplies:</strong> Paper usage, printing, and equipment</li>
                    <li><strong>Digital Footprint:</strong> Data storage, email, and video conferencing</li>
                </ul>
            </div>
        </div>
        
        <!-- Additional sections would follow a similar pattern -->
        <div class="module-section" id="section3" {% if content.current_section != 3 %}style="display: none;"{% endif %}>
            <h2>Practical Applications</h2>
            
            <div class="content-block">
                <h3>Measuring Your Carbon Footprint</h3>
                <p>Understanding your current impact is the first step toward reduction. The EcoPulse platform helps you track various components of your workplace carbon footprint.</p>
                
                <div class="image-container">
                    <img src="{{ url_for('static', filename='images/dashboard-sample.png') }}" alt="Dashboard Example">
                    <p class="caption">The EcoPulse dashboard shows your carbon footprint breakdown</p>
                </div>
            </div>
            
            <div class="content-block">
                <h3>Strategies for Reduction</h3>
                <h4>High-Impact Changes:</h4>
                <ul>
                    <li>Reduce air travel by using virtual meetings when possible</li>
                    <li>Switch to public transportation or carpool for commuting</li>
                    <li>Work remotely when appropriate</li>
                </ul>
                
                <h4>Medium-Impact Changes:</h4>
                <ul>
                    <li>Power down equipment when not in use</li>
                    <li>Use energy-efficient equipment and lighting</li>
                    <li>Reduce printing and paper usage</li>
                </ul>
                
                <h4>Easy Changes:</h4>
                <ul>
                    <li>Use reusable water bottles and coffee mugs</li>
                    <li>Adjust your computer's power settings</li>
                    <li>Choose digital documents over printed copies</li>
                </ul>
            </div>
        </div>
        
        <!-- Final section -->
        <div class="module-section" id="section{{ content.sections }}" {% if content.current_section != content.sections %}style="display: none;"{% endif %}>
            <h2>Conclusion and Resources</h2>
            
            <div class="content-block">
                <h3>Summary</h3>
                <p>In this module, we've covered the fundamental concepts of carbon management, ways to measure your impact, and strategies to reduce your carbon footprint in the workplace.</p>
                
                <p>Remember that sustainability is a journey, not a destination. Small changes, when adopted consistently and by many people, can lead to significant positive environmental impacts.</p>
            </div>
            
            <div class="content-block">
                <h3>Additional Resources</h3>
                <ul>
                    <li><a href="#" target="_blank">Carbon Footprint Calculation Guide</a></li>
                    <li><a href="#" target="_blank">Remote Work Environmental Benefits Report</a></li>
                    <li><a href="#" target="_blank">Sustainable Office Practices Handbook</a></li>
                </ul>
            </div>
            
            <div class="completion-box">
                <h3>Module Completion</h3>
                <p>You've reached the end of this module. To mark it as complete and receive your certificate, click the button below.</p>
                
                <form action="{{ url_for('employee.update_training_progress') }}" method="post">
                    <input type="hidden" name="module_id" value="{{ module.module_id }}">
                    <input type="hidden" name="progress" value="100">
                    <input type="hidden" name="completed" value="true">
                    <button type="submit" class="btn btn-success">Complete Module & Get Certificate</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Navigation between sections
    const totalSections = {{ content.sections }};
    let currentSection = {{ content.current_section }};
    
    document.getElementById('prevSection').addEventListener('click', function() {
        if (currentSection > 1) {
            showSection(currentSection - 1);
        }
    });
    
    document.getElementById('nextSection').addEventListener('click', function() {
        if (currentSection < totalSections) {
            showSection(currentSection + 1);
            updateProgress();
        }
    });
    
    function showSection(sectionNumber) {
        // Hide all sections
        const sections = document.querySelectorAll('.module-section');
        sections.forEach(section => {
            section.style.display = 'none';
        });
        
        // Show the selected section
        document.getElementById('section' + sectionNumber).style.display = 'block';
        
        // Update navigation buttons
        document.getElementById('prevSection').disabled = (sectionNumber === 1);
        document.getElementById('nextSection').disabled = (sectionNumber === totalSections);
        
        // Update current section
        currentSection = sectionNumber;
    }
    
    function updateProgress() {
        // Calculate new progress percentage
        const progressPercentage = Math.min(Math.round((currentSection / totalSections) * 100), 100);
        
        // Update progress in the database
        fetch('{{ url_for("employee.update_training_progress") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                'module_id': '{{ module.module_id }}',
                'progress': progressPercentage,
                'completed': (progressPercentage === 100) ? 'true' : 'false'
            })
        }).then(response => {
            if (response.ok) {
                // Update the UI
                const progressBar = document.querySelector('.progress-bar');
                const progressText = document.querySelector('.progress-text');
                
                progressBar.style.width = progressPercentage + '%';
                progressText.textContent = progressPercentage + '%';
            }
        }).catch(error => {
            console.error('Error updating progress:', error);
        });
    }
</script>
{% endblock %}